import pymysql
import pandas as pd

class write_db:
    def __init__(self, name, context, date_time):
        # æˆ‘ä»¬è¿™é‡Œéœ€è¦å¤šä¸€æ­¥é€‰æ‹©æ•°æ®åº“
        db = pymysql.connect(
            host='localhost',  # è¿™é‡Œè¾“å…¥ä¸»æœºåç§°ä¸€èˆ¬æ¥è¯´éƒ½æ˜¯localhost
            user='root',  # è¿™é‡Œè¾“å…¥mysqlç”¨æˆ·å
            password='root',  # è¿™é‡Œè¾“å…¥å¯†ç 
            port=3306,  # è¿™é‡Œè¾“å…¥ç«¯å£å·
            charset='utf8mb4',
            database='Zeiss'  # è¿™é‡Œé€‰æ‹©æ•°æ®åº“
        )

        # åˆ›å»ºä¸€ä¸ªæ¸¸æ ‡å¯¹è±¡
        cursor = db.cursor()

        # # åˆ›å»ºä¸€ä¸ªåä¸º user çš„è¡¨
        # table_name = "ZeissComment"
        # sql = 'create table {} (id varchar(20) not null auto_increment, name varchar(20) not null, context varchar(9999), date_time datetime, primary key(id)'.format(table_name)
        # cursor.execute(sql)
        #
        # # æŠŠåˆ›å»ºçš„è¡¨æ˜¾ç¤ºå‡ºæ¥
        # sql = 'show tables;'
        # cursor.execute(sql)
        # print("æ˜¾ç¤ºåˆ›å»ºçš„è¡¨ï¼š", cursor.fetchall())
        #
        # # æ˜¾ç¤ºè¡¨çš„ç»“æ„
        # sql = 'desc {}'.format(table_name)
        # cursor.execute(sql)
        # print("æ˜¾ç¤ºè¡¨çš„ç»“æ„ï¼š", cursor.fetchall())

        # æ’å…¥æ•°æ®
        # id = int('1')
        sql = "INSERT INTO ZeissComment(name,context,date_time) VALUES (%s, %s, %s)"
        cursor.execute(sql,(name,context,date_time))
        db.commit()
        print('æ’å…¥æˆåŠŸ')

        cursor.close()
        db.close()  # å…³é—­æ•°æ®åº“è¿æ¥

class read_db():
    def __init__(self):
        # æˆ‘ä»¬è¿™é‡Œéœ€è¦å¤šä¸€æ­¥é€‰æ‹©æ•°æ®åº“
        db = pymysql.connect(
            host='localhost',  # è¿™é‡Œè¾“å…¥ä¸»æœºåç§°ä¸€èˆ¬æ¥è¯´éƒ½æ˜¯localhost
            user='root',  # è¿™é‡Œè¾“å…¥mysqlç”¨æˆ·å
            password='root',  # è¿™é‡Œè¾“å…¥å¯†ç 
            port=3306,  # è¿™é‡Œè¾“å…¥ç«¯å£å·
            charset='utf8mb4',
            database='Zeiss'  # è¿™é‡Œé€‰æ‹©æ•°æ®åº“
        )

        # åˆ›å»ºä¸€ä¸ªæ¸¸æ ‡å¯¹è±¡
        cursor = db.cursor()

        sql = "select * from ZeissComment ORDER BY date_time desc;"
        df_data = pd.read_sql_query(sql, db)
        context = df_data['context'].tolist()
        string = ''
        comments = []
        for i in range(len(context)):
            if i < 3:
                string2 = df_data['name'][i] + ':' + df_data['context'][i]
                comments.append(string2)
                print(df_data['name'][i], ':', df_data['context'][i])
        for i in context:
            string = string + str(i)
            print(str(i))
        cursor.close()
        db.close()  # å…³é—­æ•°æ®åº“è¿æ¥
        self.text1 = string
        self.comments = comments
        print(string2)

    def get_string(self):
        text = self.text1
        return text

    def get_comments(self):
        comment1 = self.comments[0]
        comment2 = self.comments[1]
        comment3 = self.comments[2]
        return comment1, comment2, comment3

# import datetime
# date_time = datetime.datetime.now().strftime("%Y-%m-%d %H:%M:%S")
# print(date_time)
# å¾®åš
# write_db('å¯å±±æµ·éš¾å¹³', 'è”¡å¸åŠ æ²¹ï¼Œå¸¦æˆ‘å»æ¢ç´¢æ›´è¿œçš„æœªæ¥', '2022-11-10 00:53:00')
# write_db('æ‘„å½±å®‡å°å–®', 'è”¡å¸å°†æ¨åŠ¨æ›´å¤šè¡Œä¸šçš„å‘å±•ä¸è¿›æ­¥ï¼', '2022-11-04 22:33:00')
# write_db('çˆ±å–åŠ å†°æ°”æ³¡æ°´', 'è”¡å¸å¥½å‰å®³', '2022-11-01 20:25:00')
# write_db('çˆ±å–åŠ å†°æ°”æ³¡æ°´', 'è”¡å¸çš„é˜²è“å…‰é•œå¯¹æˆ‘ä»¬è¿™äº›é•¿æœŸå¯¹ç€æ‰‹æœºç”µè„‘çš„è¿‘è§†å…šå¤ªå‹å¥½äº†', '2023-02-18 22:11:00')
# write_db('å·®è¯„å¸', 'è”¡å¸é•œå¤´è¡¨è¾¾æœ‰å¾ˆå¤šæ„æƒ³ä¸åˆ°çš„é«˜çº§æ„Ÿå’Œç‚«é…·ç©æ³•', '2023-05-19 11:05:00')
# # å…¬ä¼—å·
# # è”¡å¸å®˜æ–¹
# write_db('GYHIT', 'è”¡å¸ï¼Œæ¢å¹½å…¥å¾®ã€ä¸Šå¤©æ½èƒœï¼', '2022-07-14 18:00:00')
# write_db('May Day', 'ä»å¤ªç©ºå¯„æ¥çš„â€œæ˜ä¿¡ç‰‡â€ï¼Œå¥½ç¾', '2022-07-14 18:00:00')
# write_db('Mia Chen', 'å®‡å®™æ˜Ÿç©ºæ— é™ï¼Œè”¡å¸æ¢¦æƒ³å“è¶Š', '2022-07-14 18:00:00')
# write_db('Joanneä¹”å®‰ å¢ƒéšå¿ƒè½¬', 'è”¡å¸ï¼Œä¸ä»…æ˜¯é•œå¤´', '2022-07-14 18:00:00')
# # è”¡å¸æ¶ˆè´¹å…‰å­¦
# write_db('Carol', 'è¿™ä¹ˆè½»ï¼Œå†ä¹Ÿä¸æ‹…å¿ƒå‡ºå»ç©å›æ¥è„–å­ç—›äº†', '2023-04-26 18:51:00')
# write_db('Coco å¤§ç‚', 'ç›®æµ‹åˆæ˜¯ä¸€ä¸ªå¸®å„¿å­ä¹°æ¥ï¼Œçˆ¸çˆ¸å…ˆå¸®ä½ è¯•ç”¨ç³»åˆ—', '2023-04-26 18:51:00')
# write_db('Connie Yu', 'å“‡å¡ï¼Œè¿™ä¸ªæœ›è¿œé•œçœ‹èµ·æ¥çœŸçš„è›®å°å·§çš„ï¼Œæ„Ÿè§‰å¸¦å‡ºå»æŒºæ–¹ä¾¿ï¼Œå¯ä»¥è€ƒè™‘ä¸€ä¸‹å“ˆå“ˆå“ˆ', '2023-04-26 18:51:00')
# write_db('Aki', '30è¿™ä¸ªæˆ‘ä¹‹å‰åœ¨å›½å¤–å®˜ç½‘çœ‹åˆ°äº†ï¼Œä¸€ç›´å¾ˆæœŸå¾…ï¼Œç°åœ¨ä¸­å›½ä¹Ÿç»ˆäºä¸Šå¸‚äº†ï¼Œä¹°ä¹°ä¹°ï¼', '2023-04-26 18:51:00')
# # è”¡å¸æ˜¾å¾®é•œ
# write_db('å¤å¤œå¾®å‡‰', 'å¦‚æœèƒ½æœ‰ä¸€å°è”¡å¸æ˜¾å¾®é•œï¼Œæˆ‘æƒ³ç”¨å®ƒæ¥è§‚å¯Ÿè´è¶ğŸ¦‹çš„ç¿…è†€ï¼Œæˆ‘æƒ³çŸ¥é“è´è¶ç¿…è†€ä¸Šäº”å½©æ–‘æ–“çš„é¢œè‰²æ˜¯æ€ä¹ˆäº§ç”Ÿçš„ï¼›æˆ‘è¿˜æƒ³è§‚å¯Ÿæ ‘å¶ï¼Œæˆ‘æƒ³çŸ¥é“æ ‘å¶ä»å«©ç»¿å˜ä¸ºæ·±ç»¿å†å˜ä¸ºé‡‘é»„å†å˜ä¸ºç«çº¢çš„ç§˜å¯†ï¼›æˆ‘è¿˜æƒ³è§‚å¯Ÿä¸€ç²’æ²™ï¼Œæƒ³äº†è§£ä½•ä¸ºä¸€æ²™ä¸€ä¸–ç•Œï¼›æˆ‘è¿˜æƒ³è§‚å¯ŸèŠ±è•Šï¼Œäº†è§£é›Œé›„èŠ±æ˜¯å¦‚ä½•å­•è‚²å‡ºæ¤ç‰©å®å®ï¼è¿™ä¸ªä¸–ç•Œå¤ªå¥‡å¦™äº†ï¼Œéœ€è¦æˆ‘ä»¬ç”¨å……æ»¡æ™ºæ…§çš„çœ¼ç›å»å‘ç°æ›´å¤šçš„ç¾å¥½ï¼', '2023-06-01 08:00:00')
# write_db('ç”°ç¾ç¾ ç¾å¥½äººç”Ÿ', 'å¦‚æœå›åˆ°ç«¥å¹´ï¼Œæˆ‘æƒ³ç”¨æ˜¾å¾®é•œæ”¾å¤§å¦ˆå¦ˆçš„çˆ±ã€‚ç”¨æ˜¾å¾®é•œçœ‹çœ‹å¦ˆå¦ˆçš„æ‰‹ï¼Œé‚£æ˜¯å› ä¸ºå¿™ç¢Œæ“æŒå®¶åŠ¡è€Œå˜å¾—ç²—ç³™çš„æ‰‹ï¼›ç”¨æ˜¾å¾®é•œçœ‹çœ‹å¦ˆå¦ˆç‚¸çš„éº»å¶ï¼Œèœç±½æ²¹å’Œé¢ç²‰çš„æ··åˆä½¿å¾—é£Ÿç‰©æ•£å‘å‡ºè¯±äººçš„é¦™ï¼›ç”¨æ˜¾å¾®é•œçœ‹çœ‹å¦ˆå¦ˆä¸ºæˆ‘æŠ“çš„æ˜†è™«ï¼Œè®©æˆ‘çš„ç«¥å¹´ä¹Ÿæœ‰ä¸°å¯Œå¤šå½©çš„å›å¿†ã€‚', '2023-06-01 08:00:00')
# write_db('æ¢…é›¨', 'å›åˆ°ç«¥å¹´ï¼Œå¦‚æœæ‹¥æœ‰ä¸€å°æ˜¾å¾®é•œï¼Œå½“ç„¶æ˜¯ç”¨æ¥è§‚å¯Ÿæ˜†è™«äº†ï¼Œå› ä¸ºå°æ—¶å€™æœ€å–œæ¬¢ç©æ˜†è™«ï¼Œé•¿å¤§åæ¥è§¦äº†è®¸å¤šç”µå­äº§å“ï¼Œéœ€è¦ç”¨æ˜¾å¾®é•œè§‚å¯ŸèŠ¯ç‰‡ç»†èŠ‚ï¼Œä¹Ÿæƒ³æ‹¥æœ‰ä¸€å°æ˜¾å¾®é•œæ”¾åœ¨å®¶é‡Œï¼Œç»™å°æœ‹å‹é•¿è§è¯†', '2023-06-01 08:00:00')

db = read_db()
print(db.get_comments())